<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>test graph</title>
  <meta name="description" content="{{ site.description }}">

  <!-- base font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400">
  <!-- Accent font -->
  <link href="https://fonts.googleapis.com/css?family=Antic|Carrois+Gothic+SC|Josefin+Sans:300,400|Muli:300,400|Oxygen:300,400|Raleway:300,400|Roboto:300,400" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Economica|Oswald:300|Pathway+Gothic+One" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Arima+Madurai|Cinzel+Decorative|Poiret+One|Amiri" rel="stylesheet">

  <!-- Bootstrap -->
  <!-- <link href="{{site.baseurl}}/css/bootstrap.min.css" rel="stylesheet" media="screen"> -->

  <!-- Font Awesome -->
  <!-- <link rel="stylesheet" href="{{site.baseurl}}/css/font-awesome.min.css"> -->

  <!--custom css styling -->
  <link rel="stylesheet" href="/css/main.css">

  <style>


  body{
    font-family: "Oxygen", sans-serif;
    font-weight: 300;
  }

  .dot {
    stroke: #000;
  }

  .natl {
    stroke: #000;
    stroke-width: 1;
  }

  .grid line {
    stroke: lightgrey;
    stroke-opacity: 0.7;
    shape-rendering: crispEdges;
  }

  .grid path {
    stroke-width: 0;
  }



  .x.axis line {
    display: none;
  }
  .x.axis text {
    font-size: 13px;
  }
  .axis path {
    display:none;
  }
  .y.axis line {
    display:none;
  }
  .y.axis text {
    font-size: 13px;
  }
  </style>


</head>

<!-- start of body -->
<body>
<h1 class = "blueclass">test title</h1>


<script src="https://d3js.org/d3.v4.min.js"></script>
<!-- load Color Brewer -->
<script src="https://d3js.org/d3-scale-chromatic.v0.3.js"></script>

<!-- <script src="./scripts/scatter.js" ></script> -->

<script>
// -- DEFINE CONSTANTS --
// select current year
     var year = '2014';

// radius of dots in pixels.
     var radius = 10;

// color palette of dots
      var colorPalette = d3.interpolateMagma;

// -- INITIALIZE VARIABLES --
// set dimensions of viz. w/ margins
     var margin = {top: 30, right: 0, bottom: 0, left: 250},
          width = 1000 - margin.left - margin.left,
          height = 450 - margin.top - margin.bottom;

     var body = d3.select("body");

// define scales (# pixels for each axis)
     var x = d3.scaleLinear()
          .range([0, width]);

     var y = d3.scaleBand() // Port d3.scale.ordinal to .scaleBand; rangeBands to range w/ paddingInner arg.
          .range([0, height])
          .paddingInner(0.2);

    var z = d3.scaleSequential(colorPalette);

// define look of axis
     var xAxis = d3.axisBottom()
          .scale(x)
          .ticks(5, "%");

     var yAxis = d3.axisLeft()
         .scale(y);

// gridlines in x axis function
         function make_x_gridlines() {
           return d3.axisBottom(x)
           .ticks(5)
         }

// front-matter text
     body.append("h2")
          .text("Age distribution of the world, " + year);

     body.append("div")
          .attr("class", "top-label age-label")
       .append("p")
          .text("age group");

     body.append("div")
          .attr("class", "top-label")
       .append("p")
          .text("portion of the population");

     body.append("div")
          .attr("class", "clearfix")

// -- DATA --
// import data as csv.
     d3.csv("data/DHS_stunted_unweighted.csv", function(error, data){
       if(error) throw error;

       console.log(data)

// filter the data
          var popData = data.filter(function(element) {return element.year == year});
          var y2 = data.filter(function(element) {return element.year == '2010'});

// set the domain (data range) of data
          x.domain([0, d3.max(data, function(element) { return element.avg; })]);

          y.domain(popData.map(function(element) {return element.lvdzone}));

          // z.domain([d3.max(data, function(element) { return element.avg; }), 0]);
          z.domain([1, 0]);

// create the SVG object
          var svg = body.append("svg")
               .attr("width", width + margin.left + margin.right)
               .attr("height", height + margin.top + margin.bottom)
           .append("g")
               .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the X gridlines
            svg.append("g")
               .attr("class", "grid")
                   .attr("transform", "translate(0," + height + ")")
                   .call(make_x_gridlines()
                       .tickSize(-height)
                       .tickFormat("")
                   );

// add reference line
  var natlAvg = svg.append("g")
    .attr("class", "natl");


  natlAvg.selectAll("natl")
      .data(y2)
    .enter().append("line")
  // .attr("class", "axis")
  .attr("y1", 0)
  .attr("y2", height + margin.top + margin.bottom)
  .attr("x1", function(d) {return x(d.natl)})
  .attr("x2", function(d) {return x(d.natl)});



// create dots.
          var dotGroup = svg.append("g")
               .attr("class", "dot");

          dotGroup.selectAll("dot")
               .data(y2)
            .enter().append("circle")
               .attr("cx", function(d) {return x(d.avg)})
               .attr("cy", function(d) {return y(d.lvdzone)})
               .attr("r", radius)
               .attr("fill", function(d) {return z(d.avg)})
               .attr("opacity", 1)
              //  .transition()
              //  .attr("opacity", 0.2)
              //   .transition()
              //  .duration(6000)
              // .attr("cy", function(d) {return y(d.lvdzone)})
              // .attr("r", radius)
              // .attr("cx", function(d) {return x(d.avg)})
              // .attr("opacity", 1);

        dotGroup.selectAll("dot")
          .data(popData)
                      .enter().append("circle")
          .transition()
          // .duration(4000)
          .attr("cy", function(d) {return y(d.lvdzone)})
          .attr("r", radius)
          .attr("cx", function(d) {return x(d.avg)})
          .attr("fill", function(d) {return z(d.avg)});


// draw the axes
          svg.append("g")
               .call(xAxis)
               .attr("class", "x axis")

          svg.append("g")
               .call(yAxis)
               .attr("class","y axis")
     });
</script>


</body>
</html>
